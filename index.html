<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>AR Interativo</title>

    <!-- Importando A-Frame e AR.js -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/jeromeetienne/AR.js@1.7.2/aframe/build/aframe-ar.min.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">

    <!-- Cena de AR com GPS -->
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
        
        <!-- Luz -->
        <a-light type="directional" position="1 2 1" intensity="1"></a-light>

        <!-- Objeto 3D Interativo -->
        <a-entity id="objeto3d" gps-entity-place="latitude: -23.55052; longitude: -46.633308"
                  geometry="primitive: sphere; radius: 0.5" material="color: blue"
                  animation="property: rotation; to: 0 360 0; loop: true; dur: 5000">
        </a-entity>

        <!-- Câmera com GPS -->
        <a-entity gps-camera rotation-reader></a-entity>

    </a-scene>

    <script>
        let objeto = document.getElementById("objeto3d");
        let scale = 1;
        let lastX = 0, lastY = 0;
        let isDragging = false;

        // Evento de toque inicial
        objeto.addEventListener("mousedown", (event) => {
            isDragging = true;
            lastX = event.clientX;
            lastY = event.clientY;
        });

        // Evento de movimento do toque
        document.addEventListener("mousemove", (event) => {
            if (!isDragging) return;

            let deltaX = event.clientX - lastX;
            let deltaY = event.clientY - lastY;

            // Rotaciona o objeto ao mover
            let rotation = objeto.getAttribute("rotation");
            rotation.y += deltaX * 0.5;
            rotation.x -= deltaY * 0.5;
            objeto.setAttribute("rotation", rotation);

            lastX = event.clientX;
            lastY = event.clientY;
        });

        // Evento de soltar o toque
        document.addEventListener("mouseup", () => {
            isDragging = false;
        });

        // Evento de rolagem para aumentar/diminuir o tamanho
        document.addEventListener("wheel", (event) => {
            scale += event.deltaY * -0.001;
            scale = Math.max(0.5, Math.min(3, scale)); // Limita entre 0.5 e 3
            objeto.setAttribute("scale", `${scale} ${scale} ${scale}`);
        });

        // Toque para mudar a cor
        objeto.addEventListener("click", () => {
            let corAtual = objeto.getAttribute("material").color;
            objeto.setAttribute("material", "color", corAtual === "blue" ? "red" : "blue");
        });

        // Solicitar permissão de GPS
        window.onload = function() {
            navigator.geolocation.getCurrentPosition(function(position) {
                console.log("Localização obtida: ", position.coords.latitude, position.coords.longitude);
            }, function(error) {
                alert("Ative a localização para a AR funcionar!");
            });
        };
    </script>

</body>
</html>
